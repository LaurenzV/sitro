<html>
<body>

<style>
  #pdf-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
  }
  .pdf-image {
    width: 50%; /* Adjust as necessary for size and spacing */
    box-sizing: border-box;
    padding: 5px; /* Spacing between images */
  }
  .pdf-image img {
    width: 100%;
    height: auto;
    display: block; /* Remove extra space below the image */
  }
</style>

<script src="pdf.mjs" type="module"></script>

<script type="module">
  var url = 'new.pdf';
  var { pdfjsLib } = globalThis;
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdf.worker.mjs';

  var loadingTask = pdfjsLib.getDocument(url);
  loadingTask.promise.then(function(pdf) {
    console.log('PDF loaded');
    var numPages = pdf.numPages;
    var renderedPages = 0;
    var container = document.getElementById('pdf-container');

    var allPagesRendered = new CustomEvent('allPagesRendered'); // Define custom event

    for (let pageNumber = 1; pageNumber <= numPages; pageNumber++) {
      pdf.getPage(pageNumber).then(function(page) {
        var scale = 2;
        var viewport = page.getViewport({scale: scale});
        var canvas = document.createElement('canvas');
        var context = canvas.getContext('2d', { willReadFrequently: true });
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        var renderContext = {
          canvasContext: context,
          viewport: viewport
        };

        var renderTask = page.render(renderContext);
        renderTask.promise.then(function () {
          console.log('Page ' + pageNumber + ' rendered');

          // Convert canvas to PNG URL and create img element
          var imgSrc = canvas.toDataURL("image/png");
          var img = document.createElement('img');
          img.id = "page-" + pageNumber;
          img.src = imgSrc;
          img.alt = 'Page ' + pageNumber;

          // Create a wrapper div for styling and append the img
          var imgWrapper = document.createElement('div');
          imgWrapper.className = 'pdf-image';
          imgWrapper.appendChild(img);
          container.appendChild(imgWrapper);

          renderedPages++;
          if (renderedPages === numPages) {
              console.log("done!");
            document.dispatchEvent(allPagesRendered); // Dispatch event when all pages are rendered
            var doneDiv = document.createElement("div");
            doneDiv.id = "done";
            document.body.appendChild(doneDiv);
        }
        });
      });
    }
  }, function (reason) {
    console.error(reason);
  });
</script>

<div id="pdf-container"></div>

</body>
</html>
